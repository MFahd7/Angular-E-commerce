import{a as j}from"./chunk-DAXPEHMZ.js";import{a as q,b as h,c as R,d as z,e as G,f as v,h as A,i as M,j as U,k as Y,m as B}from"./chunk-KDAZZI2D.js";import{a as $}from"./chunk-JHWFBJCD.js";import{D as O,p as N}from"./chunk-6AZ3IQKA.js";import"./chunk-OOTTVPT5.js";import"./chunk-GLXZBIO7.js";import{$ as f,Cb as m,Eb as p,Jb as V,Ka as T,Lb as s,Mb as P,Na as o,Nb as C,Tb as b,W as w,Ya as D,aa as _,lb as x,mb as g,nb as E,ob as L,pb as I,qb as u,rb as r,sb as a,tb as c,zb as S}from"./chunk-26VLXO62.js";import"./chunk-4CLCTAJ7.js";var F=n=>["/product-details",n];function H(n,t){n&1&&(r(0,"div",1),c(1,"app-cart-loader"),a())}function J(n,t){n&1&&c(0,"i",28)}function K(n,t){n&1&&c(0,"i",29)}function W(n,t){n&1&&c(0,"i",28)}function X(n,t){n&1&&c(0,"i",31)}function Z(n,t){if(n&1){let e=S();r(0,"div",15)(1,"div",18),c(2,"img",19),a(),r(3,"div",20)(4,"div",21)(5,"p",22),s(6),a(),r(7,"span",23),s(8),a(),r(9,"button",24),m("click",function(){let i=f(e).$implicit,d=p(2);return _(d.deleteProduct(i.product._id))}),c(10,"i",25),r(11,"span"),s(12,"Remove"),a()()(),r(13,"div",26)(14,"button",27),m("click",function(){let i=f(e),d=i.$implicit,y=i.$index,k=p(2);return _(k.updateProductCount(d.count+1,d.product._id,y))}),x(15,J,1,0,"i",28)(16,K,1,0,"i",29),a(),r(17,"span",30),s(18),a(),r(19,"button",27),m("click",function(){let i=f(e),d=i.$implicit,y=i.$index,k=p(2);return _(k.updateProductCount(d.count-1,d.product._id,y))}),x(20,W,1,0,"i",28)(21,X,1,0,"i",31),a()()()()}if(n&2){let e=t.$implicit,l=t.$index,i=p(2);o(),u("routerLink",b(12,F,e.product._id)),o(),u("src",e.product.imageCover,T)("alt",e.product.title),o(3),u("routerLink",b(14,F,e.product._id)),o(),C(" ",e.product.title," "),o(),u("routerLink",b(16,F,e.product._id)),o(),C(" Price: ",e.price," "),o(6),u("disabled",i.updateLoading),o(),g(i.updateLoading&&i.currentIndex==l?15:16),o(3),P(e.count),o(),u("disabled",i.updateLoading),o(),g(i.updateLoading&&i.currentIndex==l?20:21)}}function ee(n,t){n&1&&(r(0,"div",16)(1,"p",32),s(2,"Your cart is empty"),a()())}function te(n,t){if(n&1){let e=S();r(0,"div",17)(1,"button",33),m("click",function(){f(e);let i=p(2);return _(i.clearCart())}),s(2," Clear cart "),a(),r(3,"button",34),m("click",function(){f(e);let i=p(2);return _(i.isFormOpen=!0)}),s(4," Checkout "),a()()}}function re(n,t){if(n&1&&(r(0,"div",2)(1,"h1",13),s(2,"Shop Cart"),a(),r(3,"span",14),s(4),a(),L(5,Z,22,18,"div",15,E,!1,ee,3,0,"div",16),x(8,te,5,0,"div",17),a()),n&2){let e=p();o(4),C("Total cart price: ",e.cartData==null||e.cartData.data==null?null:e.cartData.data.totalCartPrice),o(),I(e.cartData==null||e.cartData.data==null?null:e.cartData.data.products),o(3),g(e.cartData!=null&&e.cartData.numOfCartItems?8:-1)}}var Q=class n{updateLoading=!1;isLoading=!1;isFormOpen=!1;currentIndex=-1;cartData=null;CartService=w($);toastr=w(O);addressForm=new G({details:new v("",h.required),phone:new v("",h.required),city:new v("",h.required)});ngOnInit(){this.getUserCart()}updateProductCount(t,e,l){this.updateLoading=!0,this.currentIndex=l,this.CartService.updateProductQTY(e,t).subscribe({next:i=>{this.cartData=i,this.updateLoading=!1},error:i=>{this.toastr.error(i.message),this.updateLoading=!1}})}getUserCart(){this.isLoading=!0,console.log(localStorage.getItem("token"),"from cart"),this.CartService.getCart().subscribe({next:t=>{this.isLoading=!1,this.cartData=t},error:t=>{this.isLoading=!1,this.toastr.error(t.message)}})}deleteProduct(t){this.CartService.deleteProduct(t).subscribe({next:e=>{this.cartData=e},error:e=>{this.toastr.error(e.message)}})}clearCart(){this.CartService.deleteCart().subscribe({next:t=>{this.cartData=null},error:t=>{this.toastr.error(t.message)}})}checkoutCart(){if(this.cartData?.cartId){if(this.addressForm.invalid){this.addressForm.markAllAsTouched(),this.toastr.error("Please fill in all required fields.");return}this.CartService.checkoutSession(this.cartData?.cartId,{details:this.addressForm.value.details,phone:this.addressForm.value.phone,city:this.addressForm.value.city}).subscribe({next:t=>{window.location.href=t.session.url},error:t=>{this.toastr.error(t.message)}})}}closeForm(){this.isFormOpen=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=D({type:n,selectors:[["app-cart"]],decls:21,vars:4,consts:[[1,"my-4"],[1,"flex","justify-center"],[1,"bg-gray-100","p-4","rounded","h-screen","overflow-y-auto"],[1,"hidden","fixed","inset-0","bg-black/70","justify-center","items-center",3,"click"],[1,"max-w-3/4","w-96","bg-white","p-4","rounded",3,"click","ngSubmit","formGroup"],[1,"text-2xl","mb-3"],[1,"relative","z-0","w-full","mb-5","group"],["formControlName","details","type","text","name","floating_text","id","floating_text","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-main","focus:outline-none","focus:ring-0","focus:border-main","peer"],["for","floating_text",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:start-0","rtl:peer-focus:translate-x-1/4","rtl:peer-focus:left-auto","peer-focus:text-main","peer-focus:dark:text-main","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["formControlName","phone","type","tel","name","floating_phone","id","floating_phone","placeholder"," ",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-main","focus:outline-none","focus:ring-0","focus:border-main","peer"],["for","floating_phone",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:start-0","rtl:peer-focus:translate-x-1/4","rtl:peer-focus:left-auto","peer-focus:text-main","peer-focus:dark:text-main","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["formControlName","city","type","city","name","floating_city","id","floating_city","placeholder"," ",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-main","focus:outline-none","focus:ring-0","focus:border-main","peer"],["type","submit",1,"text-white","bg-main","hover:bg-main","focus:ring-4","focus:outline-none","focus:ring-main","font-medium","rounded-lg","text-sm","w-full","sm:w-auto","px-5","py-2.5","text-center","dark:bg-main","dark:hover:bg-main","dark:focus:ring-main"],[1,"font-semibold","text-3xl"],[1,"text-main","mt-2","mb-4","text-xl","block"],[1,"flex","flex-col","sm:flex-row","w-full","bg-white","p-4","rounded-xl","shadow","mb-3","gap-3","sm:gap-0"],[1,"text-center","py-4"],[1,"flex","justify-between"],[1,"cursor-pointer","w-full","sm:w-1/6","flex-shrink-0",3,"routerLink"],[1,"w-full","h-auto","rounded","object-cover",3,"src","alt"],[1,"flex-1","flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center"],[1,"space-y-1","w-full"],[1,"cursor-pointer","font-medium","text-base",3,"routerLink"],[1,"cursor-pointer","text-main","block",3,"routerLink"],[1,"mt-2","flex","gap-2","items-center","px-2","py-1","rounded","bg-red-500","text-white","text-sm","hover:bg-red-600","transition","cursor-pointer",3,"click"],[1,"fa-solid","fa-trash"],[1,"flex","items-center","gap-2","mt-3","sm:mt-0"],[1,"size-8","rounded-full","border-2","border-main","flex","justify-center","items-center","cursor-pointer",3,"click","disabled"],[1,"fa","fa-spinner","fa-spin","text-[10px]"],[1,"fa-solid","fa-plus","text-[12px]"],[1,"min-w-[20px]","text-center"],[1,"fa-solid","fa-minus","text-[12px]"],[1,"text-gray-500"],[1,"bg-red-500","rounded","text-white","px-4","py-2","cursor-pointer","active:scale-[.95]",3,"click"],[1,"bg-main","rounded","text-white","px-4","py-2","cursor-pointer","active:scale-[.95]",3,"click"]],template:function(e,l){e&1&&(r(0,"div",0),x(1,H,2,0,"div",1)(2,re,9,3,"div",2),a(),r(3,"div",3),m("click",function(){return l.closeForm()}),r(4,"form",4),m("click",function(d){return d.stopPropagation()})("ngSubmit",function(){return l.checkoutCart()}),r(5,"h2",5),s(6,"Address Form"),a(),r(7,"div",6),c(8,"input",7),r(9,"label",8),s(10,"Details"),a()(),r(11,"div",6),c(12,"input",9),r(13,"label",10),s(14,"Phone"),a()(),r(15,"div",6),c(16,"input",11),r(17,"label",8),s(18,"City"),a()(),r(19,"button",12),s(20," Submit "),a()()()),e&2&&(o(),g(l.isLoading?1:2),o(2),V("!flex",l.isFormOpen),o(),u("formGroup",l.addressForm))},dependencies:[j,B,A,q,R,z,Y,M,U,N],encapsulation:2})};export{Q as Cart};
