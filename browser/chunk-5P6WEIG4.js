import{f as g,o as x}from"./chunk-6AZ3IQKA.js";import{a as u}from"./chunk-OOTTVPT5.js";import{c as I}from"./chunk-GLXZBIO7.js";import{R as m,V as d,fa as w,g as v,ua as h}from"./chunk-26VLXO62.js";var C=(()=>{let e=class e{constructor(t,o){this.document=t,this.platformId=o,this.documentIsAccessible=g(this.platformId)}static getCookieRegExp(t){let o=t.replace(/([[\]{}()|=;+?,.*^$\\])/gi,"\\$1");return new RegExp("(?:^"+o+"|;\\s*"+o+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(t){try{return decodeURIComponent(t)}catch{return t}}check(t){return this.documentIsAccessible?(t=encodeURIComponent(t),e.getCookieRegExp(t).test(this.document.cookie)):!1}get(t){if(this.check(t)){t=encodeURIComponent(t);let r=e.getCookieRegExp(t).exec(this.document.cookie);return r?.[1]?e.safeDecodeURIComponent(r[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let t={},o=this.document;return o.cookie&&o.cookie!==""&&o.cookie.split(";").forEach(r=>{let[n,c]=r.split("=");t[e.safeDecodeURIComponent(n.replace(/^ /,""))]=e.safeDecodeURIComponent(c)}),t}set(t,o,r,n,c,l,b,R){if(!this.documentIsAccessible)return;if(typeof r=="number"||r instanceof Date||n||c||l||b){let k={expires:r,path:n,domain:c,secure:l,sameSite:b||"Lax",partitioned:R};this.set(t,o,k);return}let p=encodeURIComponent(t)+"="+encodeURIComponent(o)+";",i=r||{};if(i.expires)if(typeof i.expires=="number"){let k=new Date(new Date().getTime()+i.expires*1e3*60*60*24);p+="expires="+k.toUTCString()+";"}else p+="expires="+i.expires.toUTCString()+";";i.path&&(p+="path="+i.path+";"),i.domain&&(p+="domain="+i.domain+";"),i.secure===!1&&i.sameSite==="None"&&(i.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${t} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),i.secure&&(p+="secure;"),i.sameSite||(i.sameSite="Lax"),p+="sameSite="+i.sameSite+";",i.partitioned&&(p+="Partitioned;"),this.document.cookie=p}delete(t,o,r,n,c="Lax"){if(!this.documentIsAccessible)return;let l=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(t,"",{expires:l,path:o,domain:r,secure:n,sameSite:c})}deleteAll(t,o,r,n="Lax"){if(!this.documentIsAccessible)return;let c=this.getAll();for(let l in c)c.hasOwnProperty(l)&&this.delete(l,t,o,r,n)}};e.\u0275fac=function(o){return new(o||e)(d(w),d(h))},e.\u0275prov=m({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();var f=class extends Error{};f.prototype.name="InvalidTokenError";function j(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,a)=>{let t=a.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function L(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return j(e)}catch{return atob(e)}}function y(s,e){if(typeof s!="string")throw new f("Invalid token specified: must be a string");e||(e={});let a=e.header===!0?0:1,t=s.split(".")[a];if(typeof t!="string")throw new f(`Invalid token specified: missing part #${a+1}`);let o;try{o=L(t)}catch(r){throw new f(`Invalid token specified: invalid base64 for part #${a+1} (${r.message})`)}try{return JSON.parse(o)}catch(r){throw new f(`Invalid token specified: invalid json for part #${a+1} (${r.message})`)}}var D=class s{constructor(e,a,t,o){this.http=e;this.platformId=a;this.router=t;this.cookieService=o;if(g(this.platformId)){let r=localStorage.getItem("token");r&&this.decodedToken(r)}}userData=new v(!1);register(e){return this.http.post(`${u.BaseURL}/auth/signup`,e)}Login(e){return this.http.post(`${u.BaseURL}/auth/signin`,e)}saveToken(e){localStorage.setItem("token",e),this.cookieService.set("token",e,{path:"/",sameSite:"Lax"}),this.decodedToken(e)}forgetPassword(e){return this.http.post(`${u.BaseURL}/auth/forgotPasswords`,e)}verifyCode(e){return this.http.post(`${u.BaseURL}/auth/verifyResetCode`,e)}resetPassword(e){return this.http.put(`${u.BaseURL}/auth/resetPassword`,e)}decodedToken(e){this.cookieService.set("token",e),y(e).id&&this.userData.next(!0)}logout(){localStorage.removeItem("token"),this.cookieService.delete("token","/"),this.userData.next(!1),this.router.navigate(["/login"])}getCookieValue(e,a){let t=e+"=",o=a.split(";");for(let r=0;r<o.length;r++){let n=o[r];for(;n.charAt(0)==" ";)n=n.substring(1);if(n.indexOf(t)==0)return n.substring(t.length,n.length)}return""}static \u0275fac=function(a){return new(a||s)(d(I),d(h),d(x),d(C))};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{C as a,D as b};
